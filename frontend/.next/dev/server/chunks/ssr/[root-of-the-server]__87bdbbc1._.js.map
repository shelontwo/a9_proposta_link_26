{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///home/mauricio/.gemini/antigravity/scratch/ploomes-tracker/frontend/src/app/admin/presentations/page.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { Copy, ExternalLink, Play, Edit2, Trash2, X } from 'lucide-react';\nimport Link from 'next/link';\n\ntype Client = {\n  id: string;\n  name: string;\n  company: string;\n};\n\ntype Presentation = {\n  id: string;\n  title: string;\n  clientId: string;\n  token: string;\n  googleSlidesUrl: string;\n  ploomesDealId?: string;\n  createdAt: string;\n};\n\nexport default function PresentationsPage() {\n  const [clients, setClients] = useState<Client[]>([]);\n  const [presentations, setPresentations] = useState<Presentation[]>([]);\n  const [formData, setFormData] = useState({ title: '', clientId: '', googleSlidesUrl: '', ploomesDealId: '' });\n  const [editingPresentation, setEditingPresentation] = useState<Presentation | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const fetchData = async () => {\n    try {\n      const [clientsRes, presRes] = await Promise.all([\n        fetch('http://localhost:3001/api/clients'),\n        fetch('http://localhost:3001/api/presentations')\n      ]);\n      setClients(await clientsRes.json());\n      setPresentations(await presRes.json());\n    } catch (error) {\n      console.error('Failed to fetch data', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Convert Edit URL to Embed URL automatically\n    let embedUrl = formData.googleSlidesUrl;\n    if (embedUrl.includes('/edit')) {\n      embedUrl = embedUrl.replace('/edit', '/embed?start=false&loop=false&delayms=3000');\n    }\n\n    try {\n      const url = editingPresentation\n        ? `http://localhost:3001/api/presentations/${editingPresentation.id}`\n        : 'http://localhost:3001/api/presentations';\n      const method = editingPresentation ? 'PUT' : 'POST';\n\n      const res = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ ...formData, googleSlidesUrl: embedUrl })\n      });\n      if (res.ok) {\n        setFormData({ title: '', clientId: '', googleSlidesUrl: '', ploomesDealId: '' });\n        setEditingPresentation(null);\n        fetchData();\n      }\n    } catch (error) {\n      console.error('Failed to save presentation', error);\n    }\n  };\n\n  const handleEdit = (pres: Presentation) => {\n    setEditingPresentation(pres);\n    setFormData({\n      title: pres.title,\n      clientId: pres.clientId,\n      googleSlidesUrl: pres.googleSlidesUrl,\n      ploomesDealId: pres.ploomesDealId || ''\n    });\n  };\n\n  const handleCancelEdit = () => {\n    setEditingPresentation(null);\n    setFormData({ title: '', clientId: '', googleSlidesUrl: '', ploomesDealId: '' });\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('Tem certeza que deseja excluir esta apresentação? Os dados de rastreamento serão mantidos para histórico, mas o link deixará de funcionar.')) return;\n    try {\n      const res = await fetch(`http://localhost:3001/api/presentations/${id}`, {\n        method: 'DELETE'\n      });\n      if (res.ok) {\n        fetchData();\n      }\n    } catch (error) {\n      console.error('Failed to delete presentation', error);\n    }\n  };\n\n  const getClientName = (id: string) => clients.find(c => c.id === id)?.name || 'Unknown';\n  const getPublicLink = (token: string) => `${window.location.origin}/pub/${token}`;\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n    alert('Link copiado!');\n  };\n\n  return (\n    <div>\n      <h2 className=\"text-3xl font-bold mb-8\">Gestão de Apresentações</h2>\n\n      {/* Create/Edit Presentation Form */}\n      <div className=\"bg-brand-darkgray p-6 rounded-2xl mb-12 border border-white/10\">\n        <div className=\"flex justify-between items-center mb-4\">\n          <h3 className=\"text-xl font-bold text-brand-neon\">\n            {editingPresentation ? 'Editar Apresentação' : 'Nova Apresentação'}\n          </h3>\n          {editingPresentation && (\n            <button onClick={handleCancelEdit} className=\"text-brand-gray hover:text-white flex items-center gap-1 text-sm transition-colors\">\n              <X size={16} /> Cancelar Edição\n            </button>\n          )}\n        </div>\n        <form onSubmit={handleSubmit} className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div className=\"md:col-span-2\">\n            <label className=\"block text-xs uppercase text-brand-gray mb-1\">Título</label>\n            <input\n              type=\"text\"\n              placeholder=\"Ex: Proposta Comercial - Q1\"\n              value={formData.title}\n              onChange={e => setFormData({ ...formData, title: e.target.value })}\n              className=\"w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white focus:outline-none focus:border-brand-neon\"\n              required\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-xs uppercase text-brand-gray mb-1\">Cliente</label>\n            <select\n              value={formData.clientId}\n              onChange={e => setFormData({ ...formData, clientId: e.target.value })}\n              className=\"w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white focus:outline-none focus:border-brand-neon\"\n              required\n            >\n              <option value=\"\">Selecione um cliente...</option>\n              {clients.map(client => (\n                <option key={client.id} value={client.id}>{client.name} - {client.company}</option>\n              ))}\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-xs uppercase text-brand-gray mb-1\">Link do Google Slides (Edit/Embed)</label>\n            <input\n              type=\"url\"\n              placeholder=\"https://docs.google.com/presentation/d/.../edit\"\n              value={formData.googleSlidesUrl}\n              onChange={e => setFormData({ ...formData, googleSlidesUrl: e.target.value })}\n              className=\"w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white focus:outline-none focus:border-brand-neon\"\n              required\n            />\n          </div>\n\n          <div className=\"md:col-span-2\">\n            <label className=\"block text-xs uppercase text-brand-gray mb-1\">ID do Negócio no Ploomes (Opcional)</label>\n            <input\n              type=\"text\"\n              placeholder=\"Ex: 123456\"\n              value={formData.ploomesDealId}\n              onChange={e => setFormData({ ...formData, ploomesDealId: e.target.value })}\n              className=\"w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white focus:outline-none focus:border-brand-neon\"\n            />\n            <p className=\"text-xs text-brand-gray mt-1\">Se preenchido, enviaremos atualizações para este negócio quando a apresentação for visualizada.</p>\n          </div>\n\n          <div className=\"md:col-span-2 flex justify-end mt-4\">\n            <button type=\"submit\" className=\"bg-brand-neon text-black font-bold py-3 px-6 rounded-lg hover:shadow-glow transition-all\">\n              {editingPresentation ? 'Salvar Alterações' : 'Gerar Link Público'}\n            </button>\n          </div>\n        </form>\n      </div>\n\n      {/* List */}\n      <div className=\"grid grid-cols-1 gap-4\">\n        {presentations.map(pres => (\n          <div key={pres.id} className=\"bg-brand-darkgray p-6 rounded-xl border border-white/5 flex flex-col xl:flex-row items-start xl:items-center justify-between gap-4 group hover:border-white/10 transition-colors\">\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-3\">\n                <h4 className=\"text-lg font-bold text-white\">{pres.title}</h4>\n                {pres.ploomesDealId && (\n                  <span className=\"px-2 py-0.5 rounded-full bg-blue-500/10 text-blue-400 text-[10px] font-bold uppercase tracking-wider border border-blue-500/20\">\n                    Ploomes: {pres.ploomesDealId}\n                  </span>\n                )}\n              </div>\n              <p className=\"text-brand-gray text-sm\">Cliente: <span className=\"text-white\">{getClientName(pres.clientId)}</span></p>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <code className=\"bg-black px-2 py-1 rounded text-brand-neon text-xs\">{pres.token}</code>\n                <span className=\"text-xs text-brand-gray\">{new Date(pres.createdAt).toLocaleDateString()}</span>\n              </div>\n            </div>\n\n            <div className=\"flex flex-wrap gap-2\">\n              <button\n                onClick={() => copyToClipboard(getPublicLink(pres.token))}\n                className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors text-xs font-medium border border-white/5\"\n              >\n                <Copy size={14} /> Link\n              </button>\n              <a\n                href={getPublicLink(pres.token)}\n                target=\"_blank\"\n                className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors text-xs font-medium border border-white/5\"\n              >\n                <ExternalLink size={14} /> Testar\n              </a>\n              <Link\n                href={`/admin/stats/${pres.token}`}\n                className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-brand-neon/10 text-brand-neon hover:bg-brand-neon/20 transition-colors text-xs font-medium border border-brand-neon/20\"\n              >\n                <Play size={14} /> Stats\n              </Link>\n              <div className=\"w-[1px] h-8 bg-white/5 mx-1 hidden sm:block\" />\n              <button\n                onClick={() => handleEdit(pres)}\n                className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 hover:text-brand-neon transition-all text-xs font-medium border border-white/5\"\n              >\n                <Edit2 size={14} /> Editar\n              </button>\n              <button\n                onClick={() => handleDelete(pres.id)}\n                className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-red-400/10 hover:text-red-400 transition-all text-xs font-medium border border-white/5\"\n              >\n                <Trash2 size={14} /> Excluir\n              </button>\n            </div>\n          </div>\n        ))}\n        {presentations.length === 0 && !isLoading && (\n          <div className=\"p-12 text-center text-brand-gray border-2 border-dashed border-white/5 rounded-3xl\">\n            Nenhuma apresentação cadastrada ainda.\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;AAkBe,SAAS;IACtB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAW,EAAE;IACnD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAiB,EAAE;IACrE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;QAAE,OAAO;QAAI,UAAU;QAAI,iBAAiB;QAAI,eAAe;IAAG;IAC3G,MAAM,CAAC,qBAAqB,uBAAuB,GAAG,IAAA,iNAAQ,EAAsB;IACpF,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAE3C,IAAA,kNAAS,EAAC;QACR;IACF,GAAG,EAAE;IAEL,MAAM,YAAY;QAChB,IAAI;YACF,MAAM,CAAC,YAAY,QAAQ,GAAG,MAAM,QAAQ,GAAG,CAAC;gBAC9C,MAAM;gBACN,MAAM;aACP;YACD,WAAW,MAAM,WAAW,IAAI;YAChC,iBAAiB,MAAM,QAAQ,IAAI;QACrC,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,wBAAwB;QACxC,SAAU;YACR,aAAa;QACf;IACF;IAEA,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAEhB,8CAA8C;QAC9C,IAAI,WAAW,SAAS,eAAe;QACvC,IAAI,SAAS,QAAQ,CAAC,UAAU;YAC9B,WAAW,SAAS,OAAO,CAAC,SAAS;QACvC;QAEA,IAAI;YACF,MAAM,MAAM,sBACR,CAAC,wCAAwC,EAAE,oBAAoB,EAAE,EAAE,GACnE;YACJ,MAAM,SAAS,sBAAsB,QAAQ;YAE7C,MAAM,MAAM,MAAM,MAAM,KAAK;gBAC3B;gBACA,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,GAAG,QAAQ;oBAAE,iBAAiB;gBAAS;YAChE;YACA,IAAI,IAAI,EAAE,EAAE;gBACV,YAAY;oBAAE,OAAO;oBAAI,UAAU;oBAAI,iBAAiB;oBAAI,eAAe;gBAAG;gBAC9E,uBAAuB;gBACvB;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,+BAA+B;QAC/C;IACF;IAEA,MAAM,aAAa,CAAC;QAClB,uBAAuB;QACvB,YAAY;YACV,OAAO,KAAK,KAAK;YACjB,UAAU,KAAK,QAAQ;YACvB,iBAAiB,KAAK,eAAe;YACrC,eAAe,KAAK,aAAa,IAAI;QACvC;IACF;IAEA,MAAM,mBAAmB;QACvB,uBAAuB;QACvB,YAAY;YAAE,OAAO;YAAI,UAAU;YAAI,iBAAiB;YAAI,eAAe;QAAG;IAChF;IAEA,MAAM,eAAe,OAAO;QAC1B,IAAI,CAAC,QAAQ,+IAA+I;QAC5J,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,CAAC,wCAAwC,EAAE,IAAI,EAAE;gBACvE,QAAQ;YACV;YACA,IAAI,IAAI,EAAE,EAAE;gBACV;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iCAAiC;QACjD;IACF;IAEA,MAAM,gBAAgB,CAAC,KAAe,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,KAAK,QAAQ;IAC9E,MAAM,gBAAgB,CAAC,QAAkB,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO;IAEjF,MAAM,kBAAkB,CAAC;QACvB,UAAU,SAAS,CAAC,SAAS,CAAC;QAC9B,MAAM;IACR;IAEA,qBACE,8OAAC;;0BACC,8OAAC;gBAAG,WAAU;0BAA0B;;;;;;0BAGxC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAG,WAAU;0CACX,sBAAsB,wBAAwB;;;;;;4BAEhD,qCACC,8OAAC;gCAAO,SAAS;gCAAkB,WAAU;;kDAC3C,8OAAC,iMAAC;wCAAC,MAAM;;;;;;oCAAM;;;;;;;;;;;;;kCAIrB,8OAAC;wBAAK,UAAU;wBAAc,WAAU;;0CACtC,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAM,WAAU;kDAA+C;;;;;;kDAChE,8OAAC;wCACC,MAAK;wCACL,aAAY;wCACZ,OAAO,SAAS,KAAK;wCACrB,UAAU,CAAA,IAAK,YAAY;gDAAE,GAAG,QAAQ;gDAAE,OAAO,EAAE,MAAM,CAAC,KAAK;4CAAC;wCAChE,WAAU;wCACV,QAAQ;;;;;;;;;;;;0CAIZ,8OAAC;;kDACC,8OAAC;wCAAM,WAAU;kDAA+C;;;;;;kDAChE,8OAAC;wCACC,OAAO,SAAS,QAAQ;wCACxB,UAAU,CAAA,IAAK,YAAY;gDAAE,GAAG,QAAQ;gDAAE,UAAU,EAAE,MAAM,CAAC,KAAK;4CAAC;wCACnE,WAAU;wCACV,QAAQ;;0DAER,8OAAC;gDAAO,OAAM;0DAAG;;;;;;4CAChB,QAAQ,GAAG,CAAC,CAAA,uBACX,8OAAC;oDAAuB,OAAO,OAAO,EAAE;;wDAAG,OAAO,IAAI;wDAAC;wDAAI,OAAO,OAAO;;mDAA5D,OAAO,EAAE;;;;;;;;;;;;;;;;;0CAK5B,8OAAC;;kDACC,8OAAC;wCAAM,WAAU;kDAA+C;;;;;;kDAChE,8OAAC;wCACC,MAAK;wCACL,aAAY;wCACZ,OAAO,SAAS,eAAe;wCAC/B,UAAU,CAAA,IAAK,YAAY;gDAAE,GAAG,QAAQ;gDAAE,iBAAiB,EAAE,MAAM,CAAC,KAAK;4CAAC;wCAC1E,WAAU;wCACV,QAAQ;;;;;;;;;;;;0CAIZ,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAM,WAAU;kDAA+C;;;;;;kDAChE,8OAAC;wCACC,MAAK;wCACL,aAAY;wCACZ,OAAO,SAAS,aAAa;wCAC7B,UAAU,CAAA,IAAK,YAAY;gDAAE,GAAG,QAAQ;gDAAE,eAAe,EAAE,MAAM,CAAC,KAAK;4CAAC;wCACxE,WAAU;;;;;;kDAEZ,8OAAC;wCAAE,WAAU;kDAA+B;;;;;;;;;;;;0CAG9C,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC;oCAAO,MAAK;oCAAS,WAAU;8CAC7B,sBAAsB,sBAAsB;;;;;;;;;;;;;;;;;;;;;;;0BAOrD,8OAAC;gBAAI,WAAU;;oBACZ,cAAc,GAAG,CAAC,CAAA,qBACjB,8OAAC;4BAAkB,WAAU;;8CAC3B,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAG,WAAU;8DAAgC,KAAK,KAAK;;;;;;gDACvD,KAAK,aAAa,kBACjB,8OAAC;oDAAK,WAAU;;wDAAiI;wDACrI,KAAK,aAAa;;;;;;;;;;;;;sDAIlC,8OAAC;4CAAE,WAAU;;gDAA0B;8DAAS,8OAAC;oDAAK,WAAU;8DAAc,cAAc,KAAK,QAAQ;;;;;;;;;;;;sDACzG,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAK,WAAU;8DAAsD,KAAK,KAAK;;;;;;8DAChF,8OAAC;oDAAK,WAAU;8DAA2B,IAAI,KAAK,KAAK,SAAS,EAAE,kBAAkB;;;;;;;;;;;;;;;;;;8CAI1F,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CACC,SAAS,IAAM,gBAAgB,cAAc,KAAK,KAAK;4CACvD,WAAU;;8DAEV,8OAAC,0MAAI;oDAAC,MAAM;;;;;;gDAAM;;;;;;;sDAEpB,8OAAC;4CACC,MAAM,cAAc,KAAK,KAAK;4CAC9B,QAAO;4CACP,WAAU;;8DAEV,8OAAC,sOAAY;oDAAC,MAAM;;;;;;gDAAM;;;;;;;sDAE5B,8OAAC,0LAAI;4CACH,MAAM,CAAC,aAAa,EAAE,KAAK,KAAK,EAAE;4CAClC,WAAU;;8DAEV,8OAAC,0MAAI;oDAAC,MAAM;;;;;;gDAAM;;;;;;;sDAEpB,8OAAC;4CAAI,WAAU;;;;;;sDACf,8OAAC;4CACC,SAAS,IAAM,WAAW;4CAC1B,WAAU;;8DAEV,8OAAC,2MAAK;oDAAC,MAAM;;;;;;gDAAM;;;;;;;sDAErB,8OAAC;4CACC,SAAS,IAAM,aAAa,KAAK,EAAE;4CACnC,WAAU;;8DAEV,8OAAC,oNAAM;oDAAC,MAAM;;;;;;gDAAM;;;;;;;;;;;;;;2BAhDhB,KAAK,EAAE;;;;;oBAqDlB,cAAc,MAAM,KAAK,KAAK,CAAC,2BAC9B,8OAAC;wBAAI,WAAU;kCAAqF;;;;;;;;;;;;;;;;;;AAO9G"}}]
}